<html><head><base href="https://google.fr"><title>Cinoche FR Images</title><style>body{font-family:Arial,sans-serif;background:linear-gradient(45deg,#1a1a2e,#16213e,#0f3460);background-size:400% 400%;animation:gradientBG 15s ease infinite;margin:0;padding:20px;color:#ffffff}.container{display:flex;max-width:1400px;margin:0 auto;background:rgba(0,0,0,0.6);border-radius:15px;box-shadow:0 0 20px rgba(0,0,0,0.7);overflow:hidden}.left-panel{flex:0 0 300px;padding:20px;border-right:1px solid #444;background:rgba(0,0,0,0.4)}.right-panel{flex:1;padding:20px;background:rgba(255,255,255,0.05);overflow-y:auto;max-height:90vh}h1{color:#38bdf8;text-align:center;margin-top:0;text-shadow:2px 2px 8px rgba(0,0,0,0.6);font-size:2.3em;animation:shimmer 5s infinite}.subtitle{font-size:0.5em;background:linear-gradient(45deg,#ff0000,#ff000f);-webkit-background-clip:text;background-clip:text;color:transparent;display:inline-block}.input-group{position:relative;margin-bottom:15px}label{display:inline-block;margin-bottom:5px;font-weight:bold;color:#38bdf8}input[type="text"],input[type="number"],textarea,select{width:100%;padding:8px;border:1px solid #444;border-radius:4px;background-color:#2a2a2a;color:#ffffff}button{background-color:#4ade80;color:#0f0f0f;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;margin:5px;font-weight:bold;transition:background-color 0.3s ease,transform 0.3s ease}button:hover{background-color:#22c55e;transform:scale(1.05)}#guide-button{background-color:#3b82f6;color:white;float:right;margin-right:10px}#guide-button:hover{background-color:#2563eb}#spam-generate{background-color:#ef4444}#spam-generate.active{background-color:#dc2626}.explain-btn{display:none}.generated-images{display:flex;flex-wrap:wrap;justify-content:center}.image-container{margin:10px;text-align:center;position:relative;cursor:pointer;border-radius:10px;overflow:hidden}.image-container img{max-width:100%;border:2px solid #444;border-radius:10px;transition:transform 0.3s ease,box-shadow 0.3s ease}.image-container img:hover{transform:scale(1.05);box-shadow:0 0 15px rgba(0,0,0,0.6)}#error-message{color:#ef4444;text-align:center;margin-top:10px}#loading{text-align:center;margin-bottom:20px;font-style:italic;color:#38bdf8}.size-inputs{display:flex;justify-content:space-between}.size-inputs .input-group{width:48%}.custom-options{display:flex;flex-wrap:nowrap;gap:10px;margin-bottom:20px}.custom-options>div{flex:1}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.4)}.modal-content{background-color:#f0f0f0;margin:5% auto;padding:20px;border:1px solid #888;width:90%;max-width:800px;max-height:80vh;overflow-y:auto;color:#333}.close{color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer}.close:hover,.close:focus{color:#000;text-decoration:none;cursor:pointer}::-webkit-scrollbar{width:10px}::-webkit-scrollbar-track{background:#444}::-webkit-scrollbar-thumb{background:#38bdf8;border-radius:5px}::-webkit-scrollbar-thumb:hover{background:#0ea5e9}.fullscreen-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.9);z-index:1000;justify-content:center;align-items:center;flex-direction:column}.fullscreen-image{max-width:90%;max-height:80%;object-fit:contain}.fullscreen-prompt{color:#ffffff;font-size:18px;margin-bottom:20px;text-align:center;max-width:80%}.fullscreen-controls{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:20px}.fullscreen-controls button{background-color:rgba(255,255,255,0.2);color:#ffffff;border:none;padding:10px 20px;cursor:pointer;font-size:16px;border-radius:5px;transition:background-color 0.3s ease,transform 0.3s ease}.fullscreen-controls button:hover{background-color:rgba(255,255,255,0.3);transform:scale(1.05)}.image-container{position:relative}.download-icon,.trash-icon{position:absolute;top:10px;background-color:rgba(0,0,0,0.5);border-radius:50%;padding:5px;cursor:pointer;transition:transform 0.3s ease,background-color 0.3s ease}.download-icon{right:50px}.trash-icon{right:10px}.download-icon:hover,.trash-icon:hover{transform:scale(1.1);background-color:rgba(0,0,0,0.7)}.copy-icon{position:absolute;top:10px;right:90px;background-color:rgba(0,0,0,0.5);border-radius:50%;padding:5px;cursor:pointer;transition:transform 0.3s ease,background-color 0.3s ease}.copy-icon:hover{transform:scale(1.1);background-color:rgba(0,0,0,0.7)}@media (max-width:768px){.container{flex-direction:column;padding:10px}.left-panel{flex:1;border-right:none;border-bottom:1px solid #444;padding:15px;text-align:center}.right-panel{flex:1;padding:15px;max-height:unset}.custom-options{flex-direction:column}.custom-options>div{flex:unset;margin-bottom:10px}.size-inputs{flex-direction:column}.size-inputs .input-group{width:100%}.image-container img{max-width:100%}button{width:100%;margin:10px 0}}@keyframes shimmer{0%{text-shadow:2px 2px 8px rgba(0,0,0,0.6)}50%{text-shadow:2px 2px 12px rgba(56,189,248,0.8)}100%{text-shadow:2px 2px 8px rgba(0,0,0,0.6)}}@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}</style></head><body><div class="container"><div class="left-panel"><h1>Générateur img.<br><span class="subtitle">Created by @Cinoche FR</span></h1><form id="generation-form"><div class="input-group"><label for="num-images">Nombre d'images :</label><input type="number" id="num-images" min="1" max="4" value="1"></div><div class="input-group"><label for="num-inference-steps">Nombre d'étapes d'inférence :</label><input type="number" id="num-inference-steps" min="1" max="512" value="25"></div><div class="input-group"><label for="guidance-scale">Échelle d'orientation :</label><input type="number" id="guidance-scale" min="1" max="20" step="0.1" value="7.5"></div><div class="input-group"><label for="strength">Force :</label><input type="number" id="strength" min="0" max="1" step="0.1" value="0.8"></div><div class="size-inputs"><div class="input-group"><label for="width">Largeur :</label><select id="width"><option value="128">128</option><option value="256">256</option><option value="384">384</option><option value="448">448</option><option value="512">512</option><option value="576">576</option><option value="640">640</option><option value="704">704</option><option value="768">768</option><option value="832">832</option><option value="896">896</option><option value="960">960</option><option value="1024" selected="">1024</option></select></div><div class="input-group"><label for="height">Hauteur :</label><select id="height"><option value="128">128</option><option value="256">256</option><option value="384">384</option><option value="448">448</option><option value="512">512</option><option value="576">576</option><option value="640">640</option><option value="704">704</option><option value="768">768</option><option value="832">832</option><option value="896">896</option><option value="960">960</option><option value="1024" selected="">1024</option></select></div></div><div class="input-group"><label for="seed">Grain (facultatif) :</label><input type="number" id="seed" min="0"></div><div class="input-group"><label for="use-compel"><input type="checkbox" id="use-compel"> Imposer directives</label></div><div class="input-group"><label for="version-rapide"><input type="radio" id="version-rapide" name="version" value="rapide" checked> Version rapide</label></div><div class="input-group"><label for="version-developpeur"><input type="radio" id="version-developpeur" name="version" value="developpeur"> Version Développeur</label></div></form><div id="error-message"></div></div><div class="right-panel"><div class="prompt-section"><div class="input-group"><label for="prompt">Invite de texte :</label><textarea id="prompt" rows="3" required=""></textarea></div><div class="input-group"><label for="negative-prompt">Invite négative :</label><textarea id="negative-prompt" rows="2"></textarea></div></div><div class="custom-options"><div><label for="style">Style:</label><select id="style" name="style"><option value="none">None</option><option value="hyper-realistic">Hyper-Realistic</option><option value="3d">3D</option><option value="old-cartoon-30s">Old cartoon 30s</option><option value="70s">70s</option><option value="80s">80s</option><option value="abstract">Abstract</option><option value="anime">Anime</option><option value="cartoon">Cartoon</option><option value="cinematic">Cinematic</option><option value="cinematic-horror">Cinematic Horror</option><option value="claymation">Claymation</option><option value="comic-book">Comic Book</option><option value="creepy">Creepy</option><option value="cyberpunk">Cyberpunk</option><option value="glow-in-the-dark">Glow in the Dark</option><option value="gta">GTA</option><option value="mad-max">Mad Max</option><option value="mangaka">Mangaka</option><option value="midjourney">Midjourney</option><option value="neon-led-light">Neon LED Light</option><option value="oil-painting">Oil Painting</option><option value="origami">Origami</option><option value="pixar">Pixar</option><option value="science-fiction">Science Fiction</option><option value="sketch">Sketch</option><option value="surreal">Surreal</option><option value="vintage">Vintage</option><option value="watercolor">Watercolor</option></select></div><div><label for="camera">Caméra:</label><select id="camera" name="camera"><option value="none">None</option><option value="dslr">DSLR</option><option value="mirrorless">Mirrorless</option><option value="polaroid">Polaroid</option><option value="disposable">Disposable</option><option value="pinhole">Pinhole</option><option value="large-format">Large Format</option><option value="medium-format">Medium Format</option><option value="rangefinder">Rangefinder</option><option value="point-and-shoot">Point and Shoot</option><option value="smartphone">Smartphone</option><option value="action-cam">Action Camera</option><option value="360-camera">360 Camera</option><option value="drone">Drone Camera</option><option value="film">Film Camera</option><option value="instant">Instant Camera</option><option value="lomography">Lomography</option><option value="toy-camera">Toy Camera</option><option value="vintage-camera">Vintage Camera</option></select></div><div><label for="viewpoint">Vision:</label><select id="viewpoint" name="viewpoint"><option value="none">None</option><option value="close-up">Close-up</option><option value="medium-shot">Medium Shot</option><option value="wide-angle">Wide Angle</option><option value="aerial">Aerial</option><option value="birds-eye">Bird's Eye</option><option value="worms-eye">Worm's Eye</option><option value="first-person">First Person</option><option value="over-the-shoulder">Over the Shoulder</option><option value="dutch-angle">Dutch Angle</option><option value="panoramic">Panoramic</option><option value="fisheye">Fisheye</option><option value="macro">Macro</option><option value="telephoto">Telephoto</option></select></div><div><label for="lighting">Lumière:</label><select id="lighting" name="lighting"><option value="none">None</option><option value="natural">Natural</option><option value="studio">Studio</option><option value="golden-hour">Golden Hour</option><option value="blue-hour">Blue Hour</option><option value="dramatic">Dramatic</option><option value="low-key">Low Key</option><option value="high-key">High Key</option><option value="backlit">Backlit</option><option value="soft-box">Soft Box</option><option value="ring-light">Ring Light</option><option value="neon">Neon</option><option value="candlelight">Candlelight</option><option value="moonlight">Moonlight</option><option value="fire">Fire</option><option value="underwater">Underwater</option></select></div><div><label for="aspect-ratio">Ratio:</label><select id="aspect-ratio" name="aspect-ratio"><option value="1:1">1:1 (Square)</option><option value="4:3">4:3 (Standard)</option><option value="3:4">3:4 (Portrait)</option><option value="16:9">16:9 (Widescreen)</option><option value="9:16">9:16 (Vertical Video)</option></select></div></div><button id="generate-button" onclick="generateImages()">Générer</button><button id="spam-generate" onclick="toggleSpamGenerate()" style="color: white;">Générer du spam</button><button id="guide-button" style="float: right; margin-right: 10px; background-color: #3b82f6; color: white;">Guide</button><div id="loading" style="display: none;">Génération en cours... Veuillez patienter !</div><div class="generated-images" id="generated-images"></div></div></div><div id="explainModal" class="modal"><div class="modal-content"><span class="close">&times;</span><h2 id="explainTitle"></h2><p id="explainText"></p></div></div><div id="guideModal" class="modal"><div class="modal-content"><span class="close">&times;</span><h2 style="color: #000203;">Guide des Paramètres pour la Génération d'Images</h2><h3 style="color: #e74c3c;">Explication des termes</h3><ul style="color: #34495e;"><li><strong>Nombre d'images :</strong> Le nombre d'images que vous souhaitez générer à partir de l'invite de texte.</li><li><strong>Nombre d'étapes d'inférence :</strong> Le nombre d'étapes d'inférence indique combien de passes le modèle effectue pour affiner l'image. Un nombre d'étapes plus élevé, comme 50, peut produire des images plus détaillées, tandis qu'un nombre plus faible accélère le processus de génération mais peut diminuer la qualité ou la précision. Avec 25 étapes, le modèle trouve un équilibre entre rapidité et qualité.</li><li><strong>Échelle d'orientation (Guidance Scale) :</strong> Ce paramètre contrôle la fidélité de l'image par rapport à l'invite de texte. Une valeur de 7,5 signifie que l'image sera plutôt fidèle à la description fournie. Une valeur plus basse donne plus de liberté au modèle, tandis qu'une valeur plus élevée force le modèle à coller de plus près à l'invitation.</li><li><strong>Force :</strong> Ce paramètre régule à quel point le modèle doit s'en tenir à l'invite. Une force de 0,8 signifie que le modèle va suivre l'invite assez fidèlement, tout en conservant un peu de flexibilité créative. Si vous augmentez la force, l'image sera plus rigide par rapport à l'invite, tandis qu'une force plus faible permettrait plus de liberté dans l'interprétation.</li><li><strong>Largeur / Hauteur :</strong> La résolution de l'image en pixels.</li><li><strong>Grain (facultatif) :</strong> Ce paramètre optionnel permet d'ajouter un effet de grain à l'image, donnant un aspect plus texturé, souvent utilisé pour créer un effet vintage ou un look plus cinématographique. Si vous ne spécifiez pas de valeur, l'image sera lisse. Vous pouvez ajouter un grain léger (par exemple 0,1 à 0,3) pour une texture subtile.</li><li><strong>Imposer directives :</strong> Ce paramètre est utilisé pour appliquer des consignes strictes à l'image, en forçant le modèle à suivre certaines règles ou à éviter des éléments spécifiques.</li><li><strong>Invite de texte :</strong> C'est la description textuelle que vous donnez pour générer l'image. Le modèle utilise cette description pour interpréter et créer une image qui correspond.</li><li><strong>Invite négative :</strong> Ce paramètre permet de spécifier des éléments que vous ne voulez pas dans l'image, comme certains objets, styles ou effets.</li><li><strong>Style :</strong> Il peut s'agir de paramètres ou filtres artistiques appliqués à l'image pour lui donner une ambiance ou une esthétique particulière.</li><li><strong>Caméra :</strong> Il peut s'agir de la position, de l'angle ou du type de caméra que vous souhaitez simuler pour créer une perspective particulière dans l'image.</li><li><strong>Vision :</strong> Ce paramètre est parfois utilisé pour décrire le type de vision ou de perception que l'image tente de simuler.</li><li><strong>Éclairage :</strong> Ce paramètre contrôle la lumière dans l'image, comme la source ou la température de l'éclairage.</li><li><strong>Ratio :</strong> Le rapport de l'image, ici 1:1, signifie que l'image sera carrée.</li></ul><h3 style="color: #e74c3c;">Meilleures valeurs</h3><p style="color: #34495e;">Voici des suggestions pour chaque paramètre :</p><ul style="color: #34495e;"><li><strong>Nombre d'étapes d'inférence :</strong> Recommandé : 30 à 50 étapes. Cela offre un bon compromis entre qualité et temps de génération.</li><li><strong>Échelle d'orientation (Guidance Scale) :</strong> Recommandé : Entre 7 et 12. Une échelle de 7,5 à 10 est idéale pour suivre fidèlement l'invitation, tandis que des valeurs plus basses laissent plus de liberté créative.</li><li><strong>Force :</strong> Recommandé : 0,7 à 0,85. Pour un bon équilibre entre la structure originale et l'effet créatif de l'invitation.</li><li><strong>Grain (facultatif) :</strong> Recommandé : Laisser à 0 si vous voulez une image propre. Ajoutez un peu de grain (0,1 à 0,3) pour un effet plus texturé ou vintage.</li></ul><p style="color: #34495e;">En combinant ces suggestions, vous obtiendrez des images détaillées et alignées avec vos attentes tout en conservant un bon équilibre entre créativité et fidélité au texte.</p></div></div><div class="fullscreen-overlay" id="fullscreen-overlay"><div class="fullscreen-prompt" id="fullscreen-prompt"></div><img class="fullscreen-image" id="fullscreen-image" src="" alt="Fullscreen image"><div class="fullscreen-controls"><button onclick="navigateFullscreen(-1)">Précédent</button><button onclick="closeFullscreen()">Fermer</button><button onclick="navigateFullscreen(1)">Suivant</button></div></div><script>
let DEEPINFRA_API_KEY = "YYx19XukpXvgzA20jskkr0tiG7uhTcH7";
let MODEL = "black-forest-labs/FLUX-1-schnell";

function updateApiSettings() {
    const versionRapide = document.getElementById('version-rapide');
    if (versionRapide.checked) {
        DEEPINFRA_API_KEY = "YYx19XukpXvgzA20jskkr0tiG7uhTcH7";
        MODEL = "black-forest-labs/FLUX-1-schnell";
    } else {
        DEEPINFRA_API_KEY = "YYx19XukpXvgzA20jskkr0tiG7uhTcH7";
        MODEL = "black-forest-labs/FLUX-1-dev";
    }
}

document.getElementById('version-rapide').addEventListener('change', updateApiSettings);
document.getElementById('version-developpeur').addEventListener('change', updateApiSettings);

const explanations = {
    "num-images": "Le nombre d'images que vous souhaitez générer à partir de l'invite de texte.",
    "num-inference-steps": "Le nombre d'étapes d'inférence indique combien de passes le modèle effectue pour affiner l'image. Un nombre d'étapes plus élevé, comme 50, peut produire des images plus détaillées, tandis qu'un nombre plus faible accélère le processus de génération mais peut diminuer la qualité ou la précision. Avec 25 étapes, le modèle trouve un équilibre entre rapidité et qualité.",
    "guidance-scale": "L'échelle d'orientation détermine comment le modèle suit l'invite. Une valeur plus élevée signifie que le modèle est plus strict pour suivre l'invite, tandis qu'une valeur plus faible permet plus de diversité dans les résultats. Recommandé : Entre 7 et 12. Une échelle de 7,5 à 10 est idéale pour suivre fidèlement l'invitation, tandis que des valeurs plus basses laissent plus de liberté créative.",
    "strength": "La force détermine à quel point l'image générée doit être fidèle à l'invite par rapport aux images de référence. Une valeur élevée rendra le résultat plus proche de l'invite. Recommandé : 0,7 à 0,85. Pour un bon équilibre entre la structure originale et l'effet créatif de l'invitation.",
    "seed": "Le grain influencera la randomisation lors de la génération. Des valeurs identiques produiront des résultats similaires. Recommandé : Laisser à 0 si vous voulez une image propre. Ajoutez un peu de grain (0,1 à 0,3) pour un effet plus texturé ou vintage.",
    "use-compel": "L'option 'Imposer directives' peut forcer le modèle à suivre des instructions spécifiques pour la génération.",
    "prompt": "C'est la description textuelle que vous donnez pour générer l'image.",
    "negative-prompt": "Ce paramètre permet de spécifier des éléments que vous ne voulez pas dans l'image, comme certains objets, styles ou effets.",
    "style": "Il peut s'agir de paramètres ou filtres artistiques appliqués à l'image pour lui donner une ambiance ou une esthétique particulière.",
    "camera": "Il peut s'agir de la position, de l'angle ou du type de caméra que vous souhaitez simuler pour créer une perspective particulière dans l'image.",
    "viewpoint": "Ce paramètre est parfois utilisé pour décrire le type de vision ou de perception que l'image tente de simuler.",
    "lighting": "Ce paramètre contrôle la lumière dans l'image, comme la source ou la température de l'éclairage.",
    "aspect-ratio": "Le rapport de l'image, par exemple 1:1 signifie que l'image sera carrée (comme une image Instagram)."
};

const modal = document.getElementById('explainModal');
const modalTitle = document.getElementById('explainTitle');
const modalText = document.getElementById('explainText');
const closeBtn = document.querySelectorAll('.close');

async function generateImages() {
  if (isGenerating) {
    return;
  }
  isGenerating = true;

  const prompt = document.getElementById('prompt').value;
  const negativePrompt = document.getElementById('negative-prompt').value;
  const numImages = document.getElementById('num-images').value;
  const numInferenceSteps = document.getElementById('num-inference-steps').value;
  const guidanceScale = document.getElementById('guidance-scale').value;
  const strength = document.getElementById('strength').value;
  const width = document.getElementById('width').value;
  const height = document.getElementById('height').value;
  const seed = document.getElementById('seed').value;
  const useCompel = document.getElementById('use-compel').checked;
  const style = document.getElementById('style').value;
  const camera = document.getElementById('camera').value;
  const viewpoint = document.getElementById('viewpoint').value;
  const lighting = document.getElementById('lighting').value;

  const apiUrl = `https://api.deepinfra.com/v1/inference/${MODEL}`;
  const headers = {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${DEEPINFRA_API_KEY}`
  };

  const generatedImagesContainer = document.getElementById('generated-images');
  const errorMessage = document.getElementById('error-message');
  const loadingMessage = document.getElementById('loading');

  errorMessage.textContent = '';
  if (!prompt.trim()) {
    errorMessage.textContent = "Veuillez saisir une invite de texte pour générer des images.";
    isGenerating = false;
    return;
  }

  loadingMessage.style.display = 'block';
  let fullPrompt = prompt;
  if (style !== 'none') fullPrompt += `, ${style} style`;
  if (camera !== 'none') fullPrompt += `, shot with ${camera} camera`;
  if (viewpoint !== 'none') fullPrompt += `, ${viewpoint} view`;
  if (lighting !== 'none') fullPrompt += `, ${lighting} lighting`;

  try {
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: headers,
      body: JSON.stringify({
        prompt: fullPrompt,
        negative_prompt: negativePrompt,
        num_images: parseInt(numImages),
        num_inference_steps: parseInt(numInferenceSteps),
        guidance_scale: parseFloat(guidanceScale),
        strength: parseFloat(strength),
        width: parseInt(width),
        height: parseInt(height),
        seed: seed ? parseInt(seed) : undefined,
        use_compel: useCompel,
      }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    loadingMessage.style.display = 'none';
    saveGeneratedImages(data.images, fullPrompt);

    data.images.forEach((imageData, index) => {
      const imageContainer = createImageElement(imageData, index, fullPrompt);
      generatedImagesContainer.insertBefore(imageContainer, generatedImagesContainer.firstChild);
    });
  } catch (error) {
    loadingMessage.style.display = 'none';
    errorMessage.textContent = `Error generating images: ${error.message}`;
  } finally {
    isGenerating = false;
    if (!isSpamming) {
      stopSpamming();
    }
  }
}

window.generateImages = generateImages;

function saveImage(imageData, index) {
    const link = document.createElement('a');
    link.href = imageData;
    link.download = `generated_image_${index + 1}.png`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function openGuide() {
    const modal = document.getElementById('guideModal');
    modal.style.display = 'block';
}

document.getElementById('guide-button').addEventListener('click', openGuide);

closeBtn.forEach(closeBtn => {
    closeBtn.addEventListener('click', () => {
        document.getElementById('explainModal').style.display = 'none';
        document.getElementById('guideModal').style.display = 'none';
    });
});

window.addEventListener('click', (event) => {
    const explainModal = document.getElementById('explainModal');
    const guideModal = document.getElementById('guideModal');
    if (event.target === explainModal) {
        explainModal.style.display = 'none';
    }
    if (event.target === guideModal) {
        guideModal.style.display = 'none';
    }
});

const explainBtns = document.querySelectorAll('.explain-btn');
explainBtns.forEach(btn => btn.remove());

let isSpamming = false;
let spamInterval;
let isGenerating = false;
let currentFullscreenIndex = 0;
let savedImages = [];

document.getElementById('generation-form').addEventListener('submit', function(e) {
    e.preventDefault();
    generateImages();
});

document.getElementById('prompt').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        generateImages();
    }
});

document.getElementById('negative-prompt').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        generateImages();
    }
});

document.getElementById('aspect-ratio').addEventListener('change', function() {
    updateDimensions();
});

function updateDimensions() {
    const aspectRatio = document.getElementById('aspect-ratio').value;
    const [width, height] = aspectRatio.split(':').map(Number);
    const maxDimension = 1024;
    let newWidth, newHeight;
    if (width > height) {
        newWidth = maxDimension;
        newHeight = Math.round(maxDimension * (height / width));
    } else {
        newHeight = maxDimension;
        newWidth = Math.round(maxDimension * (width / height));
    }
    document.getElementById('width').value = newWidth;
    document.getElementById('height').value = newHeight;
}

function toggleSpamGenerate() {
    const spamButton = document.getElementById('spam-generate');
    isSpamming = !isSpamming;
    if (isSpamming) {
        spamButton.textContent = 'Stop Spamming';
        spamButton.style.backgroundColor = '#dc2626';
        spamButton.style.color = '#ffffff';
        spamInterval = setInterval(generateImages, 100);
    } else {
        stopSpamming();
    }
}

function stopSpamming() {
    const spamButton = document.getElementById('spam-generate');
    isSpamming = false;
    spamButton.textContent = 'Générer du spam';
    spamButton.style.backgroundColor = '#ef4444';
    spamButton.style.color = '#ffffff';
    clearInterval(spamInterval);
    isGenerating = false;
}

function saveGeneratedImages(images, prompt) {
    savedImages = JSON.parse(localStorage.getItem('generatedImages')) || [];
    const newImages = images.map(imageData => ({ imageData, prompt }));
    savedImages = [...newImages, ...savedImages].slice(0, 100);
    localStorage.setItem('generatedImages', JSON.stringify(savedImages));
}

function loadGeneratedImages() {
    savedImages = JSON.parse(localStorage.getItem('generatedImages')) || [];
    const generatedImagesContainer = document.getElementById('generated-images');
    generatedImagesContainer.innerHTML = ''; // Clear existing images
    savedImages.forEach((imageObj, index) => {
        const imageContainer = createImageElement(imageObj.imageData, index, imageObj.prompt);
        generatedImagesContainer.appendChild(imageContainer);
    });
}

function createImageElement(imageData, index, prompt) {
    const imageContainer = document.createElement('div');
    imageContainer.className = 'image-container';

    const img = document.createElement('img');
    img.src = imageData;
    img.alt = `Generated image ${index + 1}`;
    img.onclick = () => openFullscreen(index);

    const downloadIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    downloadIcon.setAttribute('class', 'download-icon');
    downloadIcon.setAttribute('width', '24');
    downloadIcon.setAttribute('height', '24');
    downloadIcon.setAttribute('viewBox', '0 0 24 24');
    downloadIcon.setAttribute('fill', 'none');
    downloadIcon.setAttribute('stroke', '#4ade80');
    downloadIcon.setAttribute('stroke-width', '2.5');
    downloadIcon.setAttribute('stroke-linecap', 'round');
    downloadIcon.setAttribute('stroke-linejoin', 'round');
    downloadIcon.innerHTML = '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line>';

    downloadIcon.onclick = (e) => {
        e.stopPropagation();
        saveImage(imageData, index);
    };

    const trashIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    trashIcon.setAttribute('class', 'trash-icon');
    trashIcon.setAttribute('width', '24');
    trashIcon.setAttribute('height', '24');
    trashIcon.setAttribute('viewBox', '0 0 24 24');
    trashIcon.setAttribute('fill', 'none');
    trashIcon.setAttribute('stroke', '#ef4444');
    trashIcon.setAttribute('stroke-width', '2.5');
    trashIcon.setAttribute('stroke-linecap', 'round');
    trashIcon.setAttribute('stroke-linejoin', 'round');
    trashIcon.innerHTML = '<path d="M3 6h18"></path><path d="M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6"></path>';

    trashIcon.onclick = (e) => {
        e.stopPropagation();
        removeImage(index);
    };

    const copyIcon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    copyIcon.setAttribute('class', 'copy-icon');
    copyIcon.setAttribute('width', '24');
    copyIcon.setAttribute('height', '24');
    copyIcon.setAttribute('viewBox', '0 0 24 24');
    copyIcon.setAttribute('fill', 'none');
    copyIcon.setAttribute('stroke', '#3b82f6');
    copyIcon.setAttribute('stroke-width', '2.5');
    copyIcon.setAttribute('stroke-linecap', 'round');
    copyIcon.setAttribute('stroke-linejoin', 'round');
    copyIcon.innerHTML = '<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>';

    copyIcon.onclick = (e) => {
        e.stopPropagation();
        copyPrompt(prompt);
    };

    imageContainer.appendChild(img);
    imageContainer.appendChild(downloadIcon);
    imageContainer.appendChild(trashIcon);
    imageContainer.appendChild(copyIcon);
    
    return imageContainer;
}

function removeImage(index) {
    savedImages.splice(index, 1);
    localStorage.setItem('generatedImages', JSON.stringify(savedImages));
    
    // Remove the image from the DOM
    const generatedImagesContainer = document.getElementById('generated-images');
    generatedImagesContainer.removeChild(generatedImagesContainer.children[index]);
}

function copyPrompt(prompt) {
    navigator.clipboard.writeText(prompt).then(() => {
        alert('Prompt copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy prompt: ', err);
    });
}

function checkApiKey() {
    if (!DEEPINFRA_API_KEY) {
        document.getElementById('error-message').textContent = "API key is missing. Please set your DeepInfra API key.";
        document.getElementById('generate-button').disabled = true;
        document.getElementById('spam-generate').disabled = true;
    }
}

window.addEventListener('load', () => {
    loadGeneratedImages();
    checkApiKey();
});

function openFullscreen(index) {
    currentFullscreenIndex = index;
    const overlay = document.getElementById('fullscreen-overlay');
    const image = document.getElementById('fullscreen-image');
    const prompt = document.getElementById('fullscreen-prompt');
    
    image.src = savedImages[index].imageData;
    prompt.textContent = savedImages[index].prompt;
    overlay.style.display = 'flex';
}

function closeFullscreen() {
    document.getElementById('fullscreen-overlay').style.display = 'none';
}

function navigateFullscreen(direction) {
    currentFullscreenIndex += direction;
    if (currentFullscreenIndex < 0) {
        currentFullscreenIndex = savedImages.length - 1;
    } else if (currentFullscreenIndex >= savedImages.length) {
        currentFullscreenIndex = 0;
    }
    openFullscreen(currentFullscreenIndex);
}

document.querySelector('.fullscreen-controls button:nth-child(1)').addEventListener('click', () => navigateFullscreen(-1));
document.querySelector('.fullscreen-controls button:nth-child(2)').addEventListener('click', closeFullscreen);
document.querySelector('.fullscreen-controls button:nth-child(3)').addEventListener('click', () => navigateFullscreen(1));
</script></body></html>